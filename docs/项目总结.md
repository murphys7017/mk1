# mk1（Alice）智能体系统项目总结

## 项目定位

mk1 是一个具备“感知 → 记忆 → 推理 →（行动，规划中）→ 记忆更新”认知闭环的智能体原型。
当前以 Alice 为顶层智能体角色，支持多轮对话、对话摘要、对话状态更新，并在向“可插拔 LLM / 可插拔上下文组装 / 事件驱动”方向重构。

## 当前主流程（main/Alice）

1. CLI 接收用户输入（`main.py`）
2. `Alice.respond()` 调用 `PerceptionSystem.analyze()` 并发分析输入
3. 生成 `ChatMessage`（当前仅 text 类型）
4. 调用 LLM 生成回复（当前未接入 `ContextAssembler`）
5. 将 assistant 回复写入 SQLite 历史记录

## 模块分层与职责

- 入口与顶层：`main.py`、`Alice.py`
- 感知系统：`PerceptionSystem/`（当前仅 `TextAnalyze`）
- 记忆系统：`MemorySystem/`（策略、存储、组装、摘要）
- 对话状态：`ChatStateSystem/`（状态判定与输出）
- 上下文组装：`ContextAssembler/`（拼接记忆、状态、历史）
- LLM 管理：`LLM/`（Prompt 模板 + 模型路由）
- 历史持久化：`RawChatHistory/`（SQLite / 文件版备用）
- 数据模型：`DataClass/`（ChatMessage、DialogueMessage、ChatState 等）
- 事件驱动：`EventBus.py` / `PostTurnProcessor.py`（骨架）
- 代理客户端：`Agent/QwenClient.py`

## 当前集成状态（要点）

- `DefaultGlobalContextAssembler` 已能拼装 Memory + ChatState + recent history，但尚未接入 `Alice.respond()`
- `MemorySystem` 的摘要决策与写入逻辑尚未进入主对话链路
- `EventBus` / `PostTurnProcessor` 仍是空壳，事件驱动未接入
- `DataClass/` 与 `MessageModel.py` 同时存在，处于过渡期

## 技术栈与依赖

- Python >= 3.10
- 依赖：loguru、sqlalchemy、openai、python-dotenv
- 本地推理：Ollama（`qwen3:1.7b`、`qwen3:4b`）
- 云端推理：DashScope 兼容 OpenAI API（`qwen-plus`）
- 存储：SQLite（`chat_history.db`）

## 运行方式（简要）

```bash
uv sync
uv run .\main.py
```

## 近期计划（摘自 docs/TODO.md）

- 输入与输出解耦，支持多次输入后再由 AI 输出
- 设计并接入管线化或事件化处理流程
- 增加 TTS / STT，实现语音交互
- 设计长期记忆模块，使 AI 稳定记住用户基础信息

## 参考文档

- `README.md`
- `docs/gpt-整体流程.md`
- `docs/集成收尾问题清单.md`
- `docs/TODO.md`
