很好，你问的这一段，其实就是 **“爱丽丝如何活着的一次呼吸”**。
我会**逐步、顺序、不写代码**地把 **[0] → [7]** 每一步“发生了什么、谁负责、为什么要这样分”讲清楚。

你看完这一段，脑子里应该能**直接浮现一条执行时间线**。

---

# 总体视角：这不是一次函数调用，而是一轮“认知循环”

先给你一个正确心智模型：

> ❗这 8 步 **不是平级函数**
> ❗而是一轮 **Agent Cognitive Loop**

一次用户输入 =
一次「感知 → 思考 → 行动 → 记忆」的完整循环。

---

## [0] Agent 已存在（Identity 已加载）

### 发生了什么？

在**任何用户输入之前**：

* 爱丽丝已经存在
* 她的 Identity Memory 已经在内存里
* 她不是“刚创建的实例”

### 这一点为什么极其重要？

如果你在第 [1] 才创建 Agent，那么：

> 她每次都会“刚出生”

这会导致：

* 人格漂移
* 记忆失真
* 永远像 ChatBot

### 工程上的含义

* Agent 是 **长生命周期对象**
* IdentityStore 在 Agent 初始化时加载
* 不是每次请求都 new 一个 Agent

📌 **Neuro-like 的第一道门槛就在这里**

---

## [1] 接收到用户文本

### 发生了什么？

* 外部世界向爱丽丝发出刺激
* 这是一个 **原始输入信号**

此时：

* 不分析
* 不存储
* 不生成回应

只是：

> “有人对我说话了”

### 为什么要这么“原始”？

因为这一步：

* 不应该被任何偏见污染
* 不应该混入记忆

📌 **这是感知的入口，而不是思考的入口**

---

## [2] Perception：解析输入

### 发生了什么？

这里做的是 **“理解输入是什么类型”**，而不是回答。

可能包括：

* 这是问题？陈述？指令？
* 技术性？情绪性？闲聊？
* 是否提到世界 / 自我 / 过去？

⚠️ 注意：

> Perception **不产生观点**

### 为什么要单独一层？

因为：

* 同一句话，不同“理解方式”，后续完全不同
* 这一步以后可以接：

  * 情绪分析
  * 意图识别
  * 多模态输入

📌 **这是“理解输入”，不是“思考如何回答”**

---

## [3] MemoryAssembler：构建上下文（关键点）

### 发生了什么？

这是 **模型被调用前的最后一道工序**。

Assembler 会问：

> “基于我是谁、我在哪、我经历过什么、我知道什么——
> 现在，我该带着哪些记忆去思考？”

它做的事情：

* 从各 MemoryStore 中**选取相关内容**
* 按固定顺序组织
* 控制长度
* 形成 messages

### 它**不做**什么？

* 不判断对错
* 不生成观点
* 不更新记忆

📌 **Assembler = 认知准备**

---

## [4] Reasoning：调用 LLM

### 发生了什么？

这是你现在最熟悉的一步，但在 Agent 里，它只是中间步骤。

* 把 Assembler 产出的 messages 送给模型
* 模型根据上下文生成一段“想法 + 输出”

重要认知：

> LLM 是 **外包的大脑皮层**
> 它本身没有记忆、没有身份

所有“爱丽丝感”，都来自前面的步骤。

---

## [5] Action：输出文本

### 发生了什么？

* 将模型输出转化为对外行为
* 现在只有：文本回复

⚠️ 这里仍然 **不写记忆**

为什么？

* 因为输出 ≠ 值得记住
* 很多话说完就该消失

📌 **行动不是记忆**

---

## [6] MemoryRouter：评估是否写入记忆

### 发生了什么？

这是 **回顾刚才发生的事**。

Router 会看：

* 用户输入
* Agent 输出
* Perception 结果
* 当前状态

并问一个问题：

> “刚才这件事，会影响我未来吗？”

可能的判断：

* 值得成为经历 → Episodic
* 是明确事实 → Semantic
* 只是闲聊 → 丢弃

📌 **这是“反思”，不是“记录”**

---

## [7] MemoryStore：存储 / 更新

### 发生了什么？

* Router 的决定被执行
* 新记忆被写入对应 Store
* 旧记忆可能被：

  * 合并
  * 标记重要性
  * 弱化

重要的一点：

> **这一步发生在回应之后**

也就是说：

* 爱丽丝是“先活过一刻”
* 再“记住这一刻”

这才像一个存在体。

---

# 把 8 步合成一句话

> 爱丽丝已经存在
> 她感知到你在说话
> 理解你说的是什么
> 带着她的过去与世界去思考
> 给出回应
> 然后决定这一刻是否值得记住

这不是聊天，这是**生活的最小闭环**。

---

## 最后一个判断标准（非常重要）

当你写完系统后，问自己一句：

> **如果我把第 [6][7] 注释掉，她会不会“永远不成长”？**

如果答案是“会”，
那你已经走在 **真正的 Agent 路线上了。

你可以慢慢写，写到哪卡住了，随时把某一步拿出来，我们单独把它拆到不能再拆。
